const path = require('path');
const fs = require('fs');
const os = require('os');

var deepExtend = require('deep-extend');

const customizeInterceptedTypes = (filename, targetBrowser) => {
  const srcFilePath = path.resolve(__dirname, '..', 'extension/core/modules', filename);
  let fileContent = fs.readFileSync(srcFilePath, 'utf-8');
  if(Array.isArray(targetBrowser.intercepted_resource_types)) {
    let extendedTypesText = '';
    targetBrowser.intercepted_resource_types.forEach((extendedType, index, array) => {
      extendedTypesText += `  '${extendedType}',`;
      if(index !== array.length-1) {
        extendedTypesText += os.EOL;
      }
    });
    fileContent = fileContent.replace(/  \/\* <auto-generated-content> \*\//, extendedTypesText);
  } else {
    fileContent = fileContent.replace('<auto-generated-content>', '<nothing-to-add>');
  }
  return fileContent;
};

module.exports = customizeInterceptedTypes;